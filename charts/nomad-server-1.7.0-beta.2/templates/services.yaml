{{- $replicas := .Values.bootstrap | int -}}

---
apiVersion: v1
kind: Service
metadata:
  name: nomad-server-http
  labels:
    name: nomad-server-http
spec:
  ports:
  - name: http
    port: 4646
    protocol: 'TCP'
  selector:
    app: nomad-server

{{- range $i := until $replicas  }}
---
apiVersion: v1
kind: Service
metadata:
  name: nomad-server-{{ $i }}
  labels:
    name: nomad-server-{{ $i }}
spec:
  ports:
  - name: http
    port: 4646
    protocol: 'TCP'
  - name: rpc
    port: 4647
    protocol: 'TCP'
  - name: serf-tcp
    port: 4648
    protocol: 'TCP'
  selector:
    app: nomad-server
    statefulset.kubernetes.io/pod-name: nomad-server-{{ $i }}
{{- end }}